@using Microsoft.AspNetCore.Components.Forms
@inherits InputBase<DateTime>

<input
    type="datetime-local"
    class="@CssClass"
    value="@FormatValueAsString(CurrentValue)"
    @onchange="OnChange" />

@code {
    protected override string FormatValueAsString(DateTime value) =>
        value == default ? string.Empty : value.ToString("yyyy-MM-ddTHH:mm");

    private void OnChange(ChangeEventArgs e) => CurrentValueAsString = e?.Value?.ToString();

    protected override bool TryParseValueFromString(string? value, out DateTime result, out string? validationErrorMessage)
    {
        if (string.IsNullOrEmpty(value))
        {
            result = default;
            validationErrorMessage = null;
            return true;
        }

        // HTML datetime-local uses "yyyy-MM-ddTHH:mm"
        if (DateTime.TryParse(value, out result))
        {
            validationErrorMessage = null;
            return true;
        }

        validationErrorMessage = "The chosen value is not a valid date and time.";
        return false;
    }
}